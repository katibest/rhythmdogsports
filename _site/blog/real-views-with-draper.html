<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Real Views With Draper | Rhythm Dog Sports</title>
<meta name="generator" content="Jekyll v3.8.6" />
<meta property="og:title" content="Real Views With Draper" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I recently latched on to a tweet thread that was originated by Michael Guterl (@mguterl), in which he expressed his frustration with view helpers and erb in rails. The frustration was echoed by others, and being somewhat new to Rails, I can’t say that I’ve personally felt much pain first hand, but’s my impression from the the get-go, is that erb templates seem to get ugly quickly, and helpers aren’t properly object oriented." />
<meta property="og:description" content="I recently latched on to a tweet thread that was originated by Michael Guterl (@mguterl), in which he expressed his frustration with view helpers and erb in rails. The frustration was echoed by others, and being somewhat new to Rails, I can’t say that I’ve personally felt much pain first hand, but’s my impression from the the get-go, is that erb templates seem to get ugly quickly, and helpers aren’t properly object oriented." />
<link rel="canonical" href="http://localhost:4000/blog/real-views-with-draper" />
<meta property="og:url" content="http://localhost:4000/blog/real-views-with-draper" />
<meta property="og:site_name" content="Rhythm Dog Sports" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-06-27T00:00:00-04:00" />
<script type="application/ld+json">
{"url":"http://localhost:4000/blog/real-views-with-draper","headline":"Real Views With Draper","dateModified":"2019-06-27T00:00:00-04:00","datePublished":"2019-06-27T00:00:00-04:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/real-views-with-draper"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/logo.png"}},"description":"I recently latched on to a tweet thread that was originated by Michael Guterl (@mguterl), in which he expressed his frustration with view helpers and erb in rails. The frustration was echoed by others, and being somewhat new to Rails, I can’t say that I’ve personally felt much pain first hand, but’s my impression from the the get-go, is that erb templates seem to get ugly quickly, and helpers aren’t properly object oriented.","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="stylesheet" href="https://use.typekit.net/vnr4ouz.css">
    <link href="https://fonts.googleapis.com/css?family=Inconsolata&display=swap" rel="stylesheet">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->

    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">

  </head>
  <body>
    <nav>
  <a class="nav__logo" href="/"></a>
  <input type="checkbox" id="nav__toggle">
  <label class="nav__toggle" for="nav__toggle"></label>
  <div class="nav__list">
    <div class="nav__link ">
      <a href="/who-we-are">About Us</a>
    </div>
    <div class="nav__link  ">
      <a href="/what-we-do">Agility</a>
    </div>
    <div class="nav__link  ">
      <a href="/events">Events</a>
    </div>
    <div class="nav__link   current ">
      <a href="/blog">Blog</a>
    </div>
    <div class="nav__link  ">
      <a href="/connect">Connect with Us</a>
    </div>
    <!-- <div class="nav__link nav__cta">
      <a href="/start-a-project" class="btn btn--cta btn--sm">Start a Project</a>
    </div> -->
  </div>
</nav>


    <main>
      <article class="post">
  <section class="section--light">
    

    

    

    

    
      <div class="post__header  u-contained">
        <div class="post__title">
          <div class="post__date u-push-bottom--none">27 March 2012</div>
          <h2>Real Views with Draper</h2>
          
            <div class="post__author">
              
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
              <p class="u-push-bottom--none">
                by 
      Joel Turnbull
    
              </p>
            </div>
          
        </div>
      </div>
    
  </section>

  <section class="post__body">
    <div>
    <p>I recently latched on to a tweet thread that was originated by Michael Guterl
(@mguterl), in which he expressed his frustration with view helpers and erb in
rails. The frustration was echoed by others, and being somewhat new to Rails,
I can’t say that I’ve personally felt much pain first hand, but’s my
impression from the the get-go, is that erb templates seem to get ugly
quickly, and helpers aren’t properly object oriented.</p>

<p>On the first count, I can’t much fault erb for getting ugly. Those little are
powerful, you can’t really blame the tool for providing you all the rope you
need to hang yourself with. I’m kind of intrigued by the idea of logic-less
templates though, in a masochistic kind of way, but maybe that’s an
investigation for another blog post.</p>

<p>On the lack of object orientation, I’m intrigued. This seems wrong, but what
is the pain point here exactly?</p>

<p>During the course of the thread, Chris Nelson (@superchris) mentioned he had
been working with the Draper gem on a project and it had so far seemed like a
win. The idea of Draper is to provide real ruby class between the template and
the model where presentation concerns can reside. A view class, rather than a
helper. I decided to give it a try.</p>

<p>My starting point was to seek out an erb template on a production project that
was getting particularly ugly with logic, and see if Draper could help me
clean it up. I wanted to see how much I could do with helpers, and then if an
OO view could improve upon that.</p>

<h3 id="getting-started">Getting Started</h3>

<p>I watched the Draper RailsCast. Installing the gem, I got a generator that I
could feed an existing model class. It generated a decorator class associated
to that model in a new app/decorators/ directory. The class looks like this.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">CallReportSummaryDecorator</span> <span class="o">&lt;</span> <span class="no">ApplicationDecorator</span>
   <span class="n">decorates</span> <span class="ss">:call_report_summary</span>
</code></pre></div></div>

<p>The Decorator is a design pattern that “attach(es) additional responsibilities
to an object dynamically”. Wrapper, or Presenter is another term. Our Draper
decorator is a view. It adds a layer of view related code, and delegates
everything else to the model it wraps.</p>

<p>I instantiate the new class in the controller, that here used to return a
collection of CallReportSummary objects. CallReportSummary(s) calculate and
compile some metrics, and the index page displays a table of these metrics
with a row for each summary.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">index</span>
  <span class="vi">@current_tab</span> <span class="o">=</span> <span class="s2">"Statements"</span>
  <span class="vi">@summaries</span> <span class="o">=</span>
    <span class="vi">@users</span><span class="p">.</span><span class="nf">collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span>
      <span class="no">CallReportSummaryDecorator</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span> <span class="no">CallReportSummary</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="vi">@date_range</span><span class="p">))}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The controller now returns a collection of those objects wrapped in
decorators, but the app behaves as it always has. That’s because the decorator
is automatically delegating all calls to the established model through method
missing. This is kind of an interesting divergence from the gang of four
implementation of the decorator, which get’s it’s methods by subclassing the
object it decorates.</p>

<h3 id="usage">Usage</h3>

<p>So how do we use it?</p>

<p>Consider the following piece of code that renders user data from a report
summary object into a table field:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">summary</span><span class="p">.</span><span class="nf">display_name</span> <span class="cp">%&gt;&lt;%=</span> <span class="n">ghost_icon</span><span class="p">(</span><span class="n">summary</span><span class="p">.</span><span class="nf">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
</code></pre></div></div>

<p>With a helper we could clean it up a little like:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">display_user</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
</code></pre></div></div>

<p>But that’s where things get screwy with helpers. Maybe a functional programmer
can set me straight on this someday, but it seems more suitable for
display_user to be method of the summary, as opposed to a function that acts
on it.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">summary</span><span class="p">.</span><span class="nf">display_user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
</code></pre></div></div>

<p>Regardless of your preference there, the fact remains that there’s no
intuitive way to structure gobs of helper code, in the way that standard Ruby
OOP can provide.</p>

<p>So, if you don’t like the helper, your next option is to put the display_user
method on the model, where it doesn’t belong. Views of a model are different
than the model, and you should have the capacity to view a model in different
ways. Draper provides that capacity where Rails doesn’t. With decorators, you
can leave the model alone, and implement display_user in a view that wraps the
model. Then, you can turn around and implement display_user again as many
different times, in as many different views.</p>

<p>The Draper decorator has access to the model it decorates through @model, and
to all helper functions through the h. proxy. That includes ones you’ve
defined, and standard Rails ones like link_to and content_tag.</p>

<p>So the implementation in the decorator just becomes:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def display_user
  @model.display_name + h.ghost_icon( @model.user )
end
</code></pre></div></div>

<p>I guess the lesson I learned here is that Draper, to me, is not so much about
cleaning up templates. That can be done with helpers and partials. So I
decided to investigate more the use of Draper as a tool for good OO design.</p>

<h3 id="good-design">Good Design</h3>

<p>That user data rendering code was taken from this view that renders a table
with a row for each report summary returned by the controller.</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;th&gt;</span>User<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Clicks<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Calls<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Convs<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Cost<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Cost/Click<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Cost/Call<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Click-To-Call<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"check_all"</span> <span class="na">id=</span><span class="s">"check_all"</span> <span class="na">value=</span><span class="s">"all"</span><span class="nt">/&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/thead&gt;</span>
  <span class="nt">&lt;tbody&gt;</span>
    <span class="cp">&lt;%</span> <span class="vi">@summaries</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">summary</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">summary</span><span class="p">.</span><span class="nf">display_name</span> <span class="cp">%&gt;&lt;%=</span> <span class="n">ghost_icon</span><span class="p">(</span><span class="n">summary</span><span class="p">.</span><span class="nf">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_number</span><span class="p">(</span><span class="n">summary</span><span class="p">.</span><span class="nf">total_clicks</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_number</span><span class="p">(</span><span class="n">summary</span><span class="p">.</span><span class="nf">total_calls</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_number</span><span class="p">(</span><span class="n">summary</span><span class="p">.</span><span class="nf">total_conversions</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_microcents</span><span class="p">(</span><span class="n">summary</span><span class="p">.</span><span class="nf">total_customer_cost</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_microcents</span><span class="p">(</span><span class="n">summary</span><span class="p">.</span><span class="nf">average_customer_cpc</span><span class="p">)</span>  <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_microcents</span><span class="p">(</span><span class="n">summary</span><span class="p">.</span><span class="nf">cost_per_call</span><span class="p">)</span>  <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_percentage</span><span class="p">(</span><span class="n">summary</span><span class="p">.</span><span class="nf">calls_per_click</span><span class="p">)</span>  <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">send_summary[]</span> <span class="na">id=</span><span class="s">send-</span><span class="cp">&lt;%=</span> <span class="n">summary</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">summary</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span><span class="s">"</span> <span class="na">class=</span><span class="s">"send_summary"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre></div></div>

<p>Each report row contains a checkbox that when checked and submitted, will
render that single report summary object into an email statement and send it
off to that particular client. The data rendered in that email statement is
different from the data rendered in the above administrator’s view:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;th&gt;</span>Total Amount<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Impressions<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Clicks<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Cost/Click<span class="nt">&lt;/th&gt;</span>              
      <span class="nt">&lt;th&gt;</span>Calls<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Convs<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Cost/Contact<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Click-to-Contacts<span class="nt">&lt;/th&gt;</span>
      <span class="nt">&lt;th&gt;</span>Average Position<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_microcents</span><span class="p">(</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">total_customer_cost</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">number_with_delimiter</span><span class="p">(</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">total_impressions</span><span class="p">.</span><span class="nf">to_i</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_number</span><span class="p">(</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">total_clicks</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_microcents</span><span class="p">(</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">cost_per_click</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_number</span><span class="p">(</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">total_calls</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_number</span><span class="p">(</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">total_conversions</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_microcents</span><span class="p">(</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">cost_per_call</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">format_percentage</span><span class="p">(</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">calls_per_click</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">number_with_precision</span><span class="p">(</span><span class="vi">@summary</span><span class="p">.</span><span class="nf">average_pos</span><span class="p">,</span> <span class="ss">:precision</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/thead&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre></div></div>

<p>Hence, a scenario in which a particular model is displayed in two different
ways. The driving idea here is that the template should not also be the view.
The template should be concerned primarily with styling and markup, not with
choosing the data to be displayed. We have a view decorator now that can
determine that. With that in mind, my Draper-fied tables became:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
     <span class="nt">&lt;th&gt;</span>User<span class="nt">&lt;/th&gt;</span>
      <span class="cp">&lt;%</span> <span class="n">table_view</span><span class="p">.</span><span class="nf">table_headers</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span> <span class="n">table_header</span> <span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;th&gt;</span><span class="cp">&lt;%=</span> <span class="n">table_header</span> <span class="cp">%&gt;</span><span class="nt">&lt;/th&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
     <span class="nt">&lt;th&gt;&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">"check_all"</span> <span class="na">id=</span><span class="s">"check_all"</span> <span class="na">value=</span><span class="s">"all"</span><span class="nt">/&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
  <span class="nt">&lt;/thead&gt;</span>
  <span class="nt">&lt;tbody&gt;</span>
  <span class="cp">&lt;%</span> <span class="vi">@summaries</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">summary</span><span class="o">|</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">summary</span><span class="p">.</span><span class="nf">display_user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="cp">&lt;%</span> <span class="n">summary</span><span class="p">.</span><span class="nf">attributes</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">attribute</span><span class="o">|</span> <span class="cp">%&gt;</span>
        <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">summary</span><span class="p">.</span><span class="nf">render_attribute</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
      <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;td&gt;&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span> <span class="na">name=</span><span class="s">send_summary[]</span> <span class="na">id=</span><span class="s">send-</span><span class="cp">&lt;%=</span> <span class="n">summary</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;%=</span> <span class="n">summary</span><span class="p">.</span><span class="nf">id</span> <span class="cp">%&gt;</span><span class="s">"</span> <span class="na">class=</span><span class="s">"send_summary"</span> <span class="nt">/&gt;&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/tbody&gt;</span>
<span class="nt">&lt;/table&gt;</span>
</code></pre></div></div>

<p>And the email:</p>

<div class="language-erb highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;thead&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
    <span class="cp">&lt;%</span> <span class="n">table_view</span><span class="p">.</span><span class="nf">table_headers</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span> <span class="n">table_header</span> <span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;th&gt;</span><span class="cp">&lt;%=</span> <span class="n">table_header</span> <span class="cp">%&gt;</span><span class="nt">&lt;/th&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
    <span class="cp">&lt;%</span> <span class="n">summary</span><span class="p">.</span><span class="nf">attributes</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">attribute</span><span class="o">|</span> <span class="cp">%&gt;</span>
      <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">summary</span><span class="p">.</span><span class="nf">render_attribute</span><span class="p">(</span><span class="n">attribute</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
 <span class="nt">&lt;/thead&gt;</span>
</code></pre></div></div>

<p>Note that the replacement looping code is identical between the two views. The
difference is in how table_headers and attributes are defined in the Draper
decorators that wrap the summary before it’s either 1) displayed to an admin
screen or 2) rendered into an client email.</p>

<p>Previously, our decorator was called CallReportSummaryDecorator, the name
provided by the decorator generator. My inclination, now that we have two
wrappers decorating the same model, is to rename it more appropriately to what
it is, i.e. CallReportSummaryAppTableView. And then, to have a corresponding
CallReportSummaryEmailTableView.</p>

<p>Since each table header matches up with a piece of data, to me it makes sense
to define a hash in each decorator that provides the configuration for each
table.</p>

<p>In CallReportSummaryAppTableView:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">column_attribute_map</span>
  <span class="p">{</span>
    <span class="s2">"Clicks"</span> <span class="o">=&gt;</span> <span class="ss">:total_clicks</span><span class="p">,</span>
    <span class="s2">"Calls"</span> <span class="o">=&gt;</span> <span class="ss">:total_calls</span><span class="p">,</span>
    <span class="s2">"Convs"</span> <span class="o">=&gt;</span> <span class="ss">:total_conversions</span><span class="p">,</span>
    <span class="s2">"Cost"</span> <span class="o">=&gt;</span> <span class="ss">:total_customer_cost</span><span class="p">,</span>
    <span class="s2">"Cost/Click"</span> <span class="o">=&gt;</span> <span class="ss">:average_customer_cpc</span><span class="p">,</span>
    <span class="s2">"Cost/Call"</span> <span class="o">=&gt;</span> <span class="ss">:cost_per_call</span><span class="p">,</span>
    <span class="s2">"Click-To-Call"</span> <span class="o">=&gt;</span> <span class="ss">:calls_per_click</span><span class="p">,</span>
  <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In CallReportSummaryEmailTableView:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">column_attribute_map</span>
  <span class="p">{</span>
    <span class="s2">"Total Amount"</span> <span class="o">=&gt;</span> <span class="ss">:total_customer_cost</span><span class="p">,</span>
    <span class="s2">"Impressions"</span> <span class="o">=&gt;</span> <span class="ss">:total_impressions</span><span class="p">,</span>
    <span class="s2">"Clicks"</span> <span class="o">=&gt;</span> <span class="ss">:total_clicks</span><span class="p">,</span>
    <span class="s2">"Cost/Click"</span> <span class="o">=&gt;</span> <span class="ss">:cost_per_click</span><span class="p">,</span>
    <span class="s2">"Calls"</span> <span class="o">=&gt;</span> <span class="ss">:total_calls</span><span class="p">,</span>
    <span class="s2">"Cost/Call"</span> <span class="o">=&gt;</span> <span class="ss">:cost_per_call</span><span class="p">,</span>
    <span class="s2">"Click-to-Contacts"</span> <span class="o">=&gt;</span> <span class="ss">:calls_per_click</span><span class="p">,</span>
    <span class="s2">"Average Position"</span> <span class="o">=&gt;</span> <span class="ss">:average_pos</span><span class="p">,</span>
  <span class="p">}</span>
<span class="k">end</span>
</code></pre></div></div>

<p>table_headers and attributes are methods that access that configuration:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">table_headers</span>
  <span class="n">column_attribute_map</span><span class="p">.</span><span class="nf">keys</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">attributes</span>
  <span class="n">column_attribute_map</span><span class="p">.</span><span class="nf">values</span>
<span class="k">end</span>
</code></pre></div></div>

<p>The identical implementations of those two methods in the two view classes
calls for a refactoring, a superclass, so I create a
CallReportSummaryTableView. Those methods can be defined once in that class
and inherited. render_attribute is in the same boat, it’s implementation is:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">render_attribute</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
  <span class="nb">send</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Formatted attributes that are shared between the two views, like
:calls_per_click, can be implemented in the superclass view like:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">calls_per_click</span>
  <span class="n">h</span><span class="p">.</span><span class="nf">format_percentage</span><span class="p">(</span><span class="vi">@model</span><span class="p">.</span><span class="nf">calls_per_click</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Formatted attributes specific to each leaf view class can implemented there.</p>

<p>Note that the Draper gem generates an ApplicationDecorator class where general
formatting methods, like format_percentage, can be defined. Using it, it’s
likely you could bypass application-specific helpers entirely.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">calls_per_click</span>
  <span class="n">format_percentage</span><span class="p">(</span><span class="vi">@model</span><span class="p">.</span><span class="nf">calls_per_click</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="conclusion">Conclusion</h3>

<p>I don’t know if I performed any mind blowing feats here, but I feel good about
this. It’s a bit cleaner, and my view code, previously in helpers, has a nice
OO home now where I’ve already started to do some refactoring and code-
sharing. In the template, I’m able to call display-related methods on the
model, which feels more natural than invoking a detached helper method. But I
don’t have to implement those display concerns in the model itself, where they
don’t belong.</p>

<p>All in all, I’m feeling confident that Draper is a crucial ingredient to good
design. This feels less like a gem that provides some functionality, and more
like an integral, missing piece of Rails to me.</p>

    </div>
    <div class="post__tags">
      <h5>Posted in: </h5>
      <a class="tag" href="/blog/categories/development/index.html">Development</a>
    </div>
  </section>

  <section class="post__related">
    <h3>Related Posts</h3>
    <div class="grid grid--2">
      
      
      

      
        
        

        
          <a href="/blog/refactoring-patterns-in-elixir-replace-conditional-with-polymorphism-via-protocols-part-2" class="card card--feature">
            <div class="card__content">
              <h3>Refactoring Patterns in Elixir: Replace Conditional with Polymorphism Via Protocols Part 2</h3>
              <h4>Zack Kayser</h4>
              <p class="note"></p>
              Read More &rarr;
            </div>
          </a>
          
          
        
      
        
        

        
          <a href="/blog/outsourcing-custom-development-for-fast-paced-companies" class="card card--feature">
            <div class="card__content">
              <h3>Outsourcing Custom Development for Fast-Paced Companies </h3>
              <h4>Peter Kananen</h4>
              <p class="note"></p>
              Read More &rarr;
            </div>
          </a>
          
          
        
      
        
        

        
          <a href="/blog/oh-to-be-a-domain-expert-if-only-we-knew-what-you-know" class="card card--feature">
            <div class="card__content">
              <h3>Oh, to be a Domain Expert … if we only knew what you knew.</h3>
              <h4>Kati Best</h4>
              <p class="note"></p>
              Read More &rarr;
            </div>
          </a>
          
          
        
      
        
        

        
          <a href="/blog/gaslight-your-partner-in-growth" class="card card--feature">
            <div class="card__content">
              <h3>Gaslight, Your Partner in Growth</h3>
              <h4>Steve Hennegan</h4>
              <p class="note"></p>
              Read More &rarr;
            </div>
          </a>
          
          
            
    </div>
  </section>
</article>


<section class="section--light flush">
  <div class="cta">
    <img src="/assets/img/color-shapes-one.svg" class="cta__confetti" />
    <div class="cta__container">
      <div>
        
<h3> Like what you're seeing? Let's keep in touch. </h3> <a href="/newsletter" class="btn btn--cta"> Subscribe to Our Newsletter </a>

      </div>
    </div>
    <img src="/assets/img/color-shapes-two.svg" class="cta__confetti" />
  </div>
</section>


    </main>

    
<footer>
  <div class="footer__container">
    <div class="footer__menu">
      <ul>
        <li><h5 class="u-push-bottom--none"><a class="inverse" href="/who-we-are">Who We Are</a></h5></li>
        <li><a class="inverse" href="/careers">Careers</a></li>
      </ul>
      <ul>
        <li><h5 class="u-push-bottom--none"><a class="inverse" href="/what-we-do">What We Do</a></h5></li>
        
          <li><a class="inverse" href="/what-we-do">Apprenticeship</a></li>
        
          <li><a class="inverse" href="/what-we-do">Code Check Up</a></li>
        
          <li><a class="inverse" href="/what-we-do">Custom Software Development</a></li>
        
          <li><a class="inverse" href="/what-we-do">Design Sprint</a></li>
        
          <li><a class="inverse" href="/what-we-do">Discovery Sprint</a></li>
        
          <li><a class="inverse" href="/what-we-do">Fast Forward Build</a></li>
        
      </ul>
      <ul>
        <li><h5 class="u-push-bottom--none"><a class="inverse" href="/our-work">Our Work</a></h5></li>
        
        <li><a class="inverse" href="/work/e_beam">E-Beam Services, Inc.</a></li>
        
        <li><a class="inverse" href="/work/mike-albert-fleet-solutions">Mike Albert Fleet Solutions</a></li>
        
        <li><a class="inverse" href="/work/omega">OMEGA</a></li>
        
        <li><a class="inverse" href="/work/poa">POA</a></li>
        
      </ul>
      <ul>
        <li><h5 class="u-push-bottom--none"><a class="inverse" href="/blog">Blog</a></h5></li>
        
          <li><a href="/blog/categories/business/index.html" class="inverse">Business</a></li>
        
          <li><a href="/blog/categories/design/index.html" class="inverse">Design</a></li>
        
          <li><a href="/blog/categories/development/index.html" class="inverse">Development</a></li>
        
      </ul>
      <ul>
        <li><h5 class="u-push-bottom--none"><a class="inverse" href="/connect">Connect with Us</a></h5></li>
        <li><a class="inverse" href="/events">Events</a></li>
      </ul>
    </div>
    <div class="footer__credentials">
      <a href="/" class="footer__logo"></a>
      <div class="footer__social">
        <a href="https://www.instagram.com/rhythmdogsports/" target="_blank" class="social__link instagram">
  <svg viewBox="0 0 50 50">
    <path d="M16 3C8.83 3 3 8.83 3 16v18c0 7.17 5.83 13 13 13h18c7.17 0 13-5.83 13-13V16c0-7.17-5.83-13-13-13H16zm21 8c1.1 0 2 .9 2 2s-.9 2-2 2-2-.9-2-2 .9-2 2-2zm-12 3c6.07 0 11 4.93 11 11s-4.93 11-11 11-11-4.93-11-11 4.93-11 11-11zm0 2c-4.96 0-9 4.04-9 9s4.04 9 9 9 9-4.04 9-9-4.04-9-9-9z"/>
  </svg>
</a>
<!-- <a href="http://twitter.com/teamgaslight" target="_blank" class="social__link twitter">
  <svg viewBox="0 0 50 50">
    <path d="M50.06 10.44c-1.85.82-3.83 1.37-5.91 1.62 2.12-1.27 3.76-3.29 4.52-5.69a20.473 20.473 0 0 1-6.53 2.49c-1.88-2-4.55-3.25-7.5-3.25-5.68 0-10.29 4.6-10.29 10.28 0 .8.09 1.59.27 2.34C16.08 17.81 8.5 13.72 3.43 7.5c-.89 1.52-1.39 3.29-1.39 5.17 0 3.57 1.81 6.71 4.57 8.56-1.69-.05-3.27-.52-4.66-1.29v.13c0 4.98 3.55 9.14 8.25 10.09-.86.23-1.77.36-2.71.36-.66 0-1.31-.06-1.94-.19 1.31 4.08 5.11 7.06 9.61 7.14-3.52 2.76-7.95 4.4-12.77 4.4-.83 0-1.65-.05-2.45-.14 4.55 2.92 9.95 4.62 15.76 4.62 18.91 0 29.26-15.67 29.26-29.25 0-.45-.01-.89-.03-1.33 2.01-1.46 3.75-3.27 5.13-5.33z"/>
  </svg>
</a> -->
<a href="http://facebook.com/rhythmdogsports" target="_blank" class="social__link facebook">
  <svg viewBox="0 0 50 50">
    <path d="M41 4H9C6.24 4 4 6.24 4 9v32c0 2.76 2.24 5 5 5h32c2.76 0 5-2.24 5-5V9c0-2.76-2.24-5-5-5zm-4 15h-2c-2.14 0-3 .5-3 2v3h5l-1 5h-4v15h-5V29h-4v-5h4v-3c0-4 2-7 6-7 2.9 0 4 1 4 1v4z"/>
  </svg>
</a>
<!-- <a href="http://github.com/gaslight" target="_blank" class="social__link github">
  <svg viewBox="0 0 50 50">
    <path d="M33 29c-1.8 0-3 1.52-3 4s.89 5.05 3 5c2.22-.05 3.02-2.22 3-5-.02-2.48-1.21-4-3-4zm11.26-11.93c.27-1.34.39-6.1-1.58-11.07 0 0-4.53.5-11.38 5.2-1.43-.4-3.87-.6-6.3-.6s-4.86.2-6.3.59C11.85 6.5 7.32 6 7.32 6c-1.98 4.96-1.88 9.61-1.59 11.07C3.42 19.59 2 22.61 2 26.74 2 44.71 16.91 45 20.67 45h8.66C33.09 45 48 44.71 48 26.74c0-4.13-1.42-7.15-3.74-9.67zM25.14 43H25c-9.43 0-16.84-1.34-16.84-10.5 0-2.2.78-4.23 2.62-5.92 3.07-2.82 8.26-1.33 14.16-1.33h.14c5.89 0 11.09-1.49 14.16 1.33 1.84 1.69 2.61 3.73 2.61 5.92-.01 9.16-7.28 10.5-16.71 10.5zM17 29c-1.79 0-3 2.02-3 4.5s1.21 4.5 3 4.5c1.8 0 3-2.02 3-4.5S18.8 29 17 29z"/>
  </svg>
</a> -->
<!-- <a href="https://www.youtube.com/channel/UCC36CM_uLqhoKEqSy2mjqFQ" target="_blank" class="social__link youtube">
  <svg viewBox="0 0 50 50">
    <path d="M9 4C6.24 4 4 6.24 4 9v32c0 2.76 2.24 5 5 5h32c2.76 0 5-2.24 5-5V9c0-2.76-2.24-5-5-5H9zm6 4h2.4l1.6 4 1.6-4H23l-3 7v4h-2v-4.01c-.6-1.61-2.59-5.98-3-6.99zm10 3c.89 0 1.77.27 2.33.95.43.49.67 1.28.67 2.32v1.46c0 1.04-.2 1.76-.62 2.25-.56.67-1.49 1.02-2.38 1.02s-1.8-.35-2.36-1.02c-.43-.49-.64-1.21-.64-2.25v-1.45c0-1.04.23-1.84.67-2.33.56-.68 1.32-.95 2.33-.95zm4 0h2v6c.05.27.34.39.61.39.41 0 .93-.48 1.39-1.01V11h2v8h-2v-1.38c-.81.79-1.5 1.38-2.41 1.35-.66-.02-1.12-.26-1.35-.74-.14-.28-.24-.73-.24-1.39V11zm-4 1.62c-.14 0-.27.03-.39.08a1.016 1.016 0 0 0-.53.54c-.05.13-.08.26-.08.4v2.81a1.02 1.02 0 0 0 .61.94c.12.05.25.08.39.08s.27-.03.39-.08c.36-.16.61-.52.61-.94v-2.81c0-.56-.45-1.02-1-1.02zM24.99 22h.02s6.71 0 11.19.32c.63.07 1.99.08 3.21 1.33.96.94 1.27 3.1 1.27 3.1s.32 1.53.32 4.06v2.37c0 2.53-.32 4.06-.32 4.06s-.31 2.16-1.27 3.1c-1.22 1.25-2.58 1.26-3.21 1.33-4.48.32-11.2.33-11.2.33s-8.32-.08-10.88-.32c-.71-.13-2.31-.09-3.53-1.33-.96-.95-1.27-3.11-1.27-3.11S9 35.71 9 33.18v-2.37c0-2.53.32-4.06.32-4.06s.31-2.16 1.27-3.1c1.22-1.25 2.58-1.26 3.21-1.33C18.28 22 24.99 22 24.99 22zM12 26v1.98h2V38h2V27.98h2V26h-6zm13 0v12h2v-1.25c.63.78 1.45 1.25 2.12 1.25.75 0 1.41-.4 1.66-1.18.12-.42.21-.81.21-1.7v-2.75c0-.99-.13-1.73-.26-2.15-.24-.78-.85-1.22-1.61-1.22-.98-.01-1.38.5-2.12 1.38V26h-2zm-7 3v6.69c0 .72.1 1.21.23 1.52.22.51.67.79 1.31.79.73 0 1.67-.51 2.46-1.37V38h2v-9h-2v6.27c-.44.58-1.08 1.02-1.48 1.02-.26 0-.47-.11-.52-.4V29h-2zm17.03 0c-1.01 0-1.8.32-2.37.92-.42.44-.66 1.16-.66 2.1v3.07c0 .93.27 1.58.69 2.02.57.6 1.36.9 2.39.9s1.84-.31 2.39-.95c.24-.28.39-.6.46-.95.01-.17.07-.6.07-1.11h-2v.8c0 .46-.45.84-1 .84s-1-.38-1-.84V34h4v-2.03c0-.93-.23-1.62-.64-2.06-.56-.59-1.34-.91-2.33-.91zM35 30.45c.55 0 1 .38 1 .84v1.33h-2v-1.33c0-.47.45-.84 1-.84zm-6.78.3c.55 0 .78.33.78 1.38v2.75c0 1.04-.23 1.4-.78 1.4-.31 0-.9-.21-1.22-.53v-4.38c.32-.31.91-.62 1.22-.62z"/>
  </svg>
</a> -->
<!-- <a href="https://www.linkedin.com/company/gaslight" target="_blank" class="social__link linkedin">
  <svg viewBox="0 0 50 50">
    <path d="M41 4H9C6.24 4 4 6.24 4 9v32c0 2.76 2.24 5 5 5h32c2.76 0 5-2.24 5-5V9c0-2.76-2.24-5-5-5zM17 20v19h-6V20h6zm-6-5.53c0-1.4 1.2-2.47 3-2.47s2.93 1.07 3 2.47c0 1.4-1.12 2.53-3 2.53-1.8 0-3-1.13-3-2.53zM39 39h-6V29c0-2-1-4-3.5-4.04h-.08C27 24.96 26 27.02 26 29v10h-6V20h6v2.56S27.93 20 31.81 20c3.97 0 7.19 2.73 7.19 8.26V39z"/>
  </svg>
</a> -->

      </div>
      <p class="footer__copyright">© 2019 Gaslight. All rights reserved.</p>
    </div>
  </div>
</footer>


    <script src="/assets/js/scale.fix.js"></script>
    <script src="/assets/js/rellax.min.js"></script>
    <script>
    var rellax = new Rellax('.float', {
      speed: -2,
      center: false,
      wrapper: null,
      round: true,
      vertical: true,
      horizontal: false
    });
    </script>

    <!-- Start of HubSpot Embed Code -->
    <script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/509988.js"></script>
    <!-- End of HubSpot Embed Code -->

    
  </body>
</html>
